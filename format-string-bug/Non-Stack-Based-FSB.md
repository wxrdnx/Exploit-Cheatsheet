# Non-Stack-Based FSB

## Requirement

`printf(buff)`, where `buff` is ***NOT*** a stack local variable. This means that you can't put the address to read/write on the stack easily.

## Doubly-linked Stack Address

You can write any value onto the stack through doubly-linked stack addresses. **Doubly-linked stack addressese** consists of at least three stack addresses `addr_1`, `addr_2`, `addr_3` such that `addr_1` points to `addr_2` and `addr_2` points to `addr_3`.

### Algorithm

Suppose that you want to write the value `addr` onto the stack.

1. For `i` from 0 to 7
    1. Use FSB bug to write `addr_3 + i` to `addr_2` via `addr_1`
        - In most cases, unless there is an overflow, only the last byte of `addr_2` needs to be changed.
    2. Use FSB bug to write the `i`'th byte of `addr` to `addr_3` via `addr_2`

### Example

Using the `telescope` command in `pwndbg`, you can see that `0x7fffffffdca0` points to `0x7fffffffdd90` which is a stack address. Simultaneously, `0x7fffffffdd90` points to `0x7fffffffdd98`, which is also a stack address.

![](https://i.imgur.com/xaAmoG6.png)