# Stack-based FSB

## Requirement

- Stack-based FSB (`printf(buff)`, where `buff` is a local variable located on the stack)

## Ideas

- Leak stack memory using `%p`
- Any address can be written to the stack, so arbitrary read/write is possible
    - Arbitrary read: `%s`
    - Arbitrary write: `%n`
- A small caveat for arbitrary write: let's say you want to write `0x8048000` to a memory address using the `%n` specifier. Then, you need to output `0x8048000` characters - which is quite big.
    - Solution
        - Use `%Mc` to output `M` characters at a time
        - Use `%hhn` or `%hn` to write byte/short values to a memory address, one byte/short at a time

## Memory leak

Use `%N$p` to leak the `N`'th argument (`N-5`'th stack value)

## Arbitrary read

1. Place `addr` (the address you want to read from) onto the stack
2. Use `%N$s` to read the string value from `addr`

## Arbitrary write

1. Place `addr` (the address you want to read from) onto the stack
2. Write `%Mc%N$hhn` to write `M` (as a char) to `addr`

## Pwntools

- Example

```python
# write `0xdeadbeef` to `0x8048000`, and the first formatterâ€™s offset that you control is 7:
fmtstr_payload(7, { 0x8048000: 0xdeadbeef } )
# b'%239c%13$lln%190c%14$hhn%17c%15$hhn%32c%16$hhnaa\x00\x80\x04\x08\x00\x00\x00\x00\x02\x80\x04\x08\x00\x00\x00\x00\x01\x80\x04\x08\x00\x00\x00\x00\x03\x80\x04\x08\x00\x00\x00\x00'
```
